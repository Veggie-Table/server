<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, user-scale='no'"/>
    <link rel="stylesheet" href="./signup_nick.css">
    <title>Title</title>

</head>
<body>
<section class="nick-section">

    <div style="display: flex; align-items: center;margin-top: 45px">
        <button class="back" onclick="history.back()">
            <img src="../static/images/arrow.png" style="width: 18px ; height: 18px">
        </button>
        <span class="title" style="font-weight: 500; font-size: 20px; line-height: 23.87px">회원 가입</span>
    </div>
    <div class="text">Veggie Table 이용을 위해<br><b>닉네임</b>을 입력해주세요.</div>
    <ul class ="text2">
        <li>닉네임은 맛집 리뷰 작성시 노출될 수 있어요.</li>
        <li>닉네임은 언제든지 변경할 수 있어요.</li> <!--리스트!-->
    </ul>
    <form action="/saveNickname" name = "saveNickname" method="POST">
        <div class="nick">
            <input type="text" id="nickname" name="nickname" maxlength="6" placeholder="닉네임을 입력해주세요" oninput="countChar(this); checkNickname();">
        </div>
        <div>
            <hr style="width: 328px;border: 1px;angle: -0 deg;border: 1px solid #0D1510" > <!--수평선 그리기-->
        </div >
        <div class="guide">
            <span id="checkNickname">2자 ~ 6자 사이로 입력해주세요.</span>
            <span id="countChar"style="font-size: 8px; float: right; margin-right: 10px ">0/6</span> <!--float: right 오른쪽정렬??-->
        </div>
        <input type="submit" value="시작하기" class="start_btn" id="start_btn">
    </form>
    <script>
        function countChar(input) {
            var max = 6;
            var current = input.value.length;
            var checkNickname = document.getElementById("checkNickname");

            document.getElementById("countChar").textContent = current + "/" + max;

            var startBtn = document.getElementById("start_btn");
            if (current >= 2 && current <= max) {
                startBtn.classList.add("active");
                startBtn.classList.remove("disabled");
                checkNickname.textContent = "2자 ~ 6자 사이로 입력해주세요.";
            } else {
                checkNickname.textContent = "두 글자 이상 입력해주세요";
                checkNickname.style.color = "#326144";
                startBtn.classList.remove("active");
                startBtn.setAttribute("disabled", "disabled");
            }
        }

        function checkNickname() {
            var nickname = document.getElementById("nickname").value;

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/checkNickname", true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        var checkNickname = document.getElementById("checkNickname");
                        if (response.exists) {
                            checkNickname.textContent = "이미 존재하는 닉네임입니다.";
                        } else {
                            checkNickname.textContent = "사용 가능한 닉네임입니다.";
                        }
                    } else {
                        console.error("서버 오류:", xhr.status);
                    }
                }
            };

            var data = JSON.stringify({ nickname: nickname });
            xhr.send(data);
        }
    </script>
</section>

</body>
</html>